var St=Object.defineProperty;var zt=(a,e,t)=>e in a?St(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var l=(a,e,t)=>zt(a,typeof e!="symbol"?e+"":e,t);import{c as pt,a as k,t as R,d as At}from"../chunks/DWPFZvQZ.js";import{h as W,k as Pt,b as Ht,ag as Ot,w as Nt,a as Bt,c as Mt,U as Gt,ah as jt,ai as $t,aj as Ut,ak as Ft,al as Yt,p as X,I as C,ad as L,C as u,g as Y,i as q,t as H,j as f,r as v,s as b,am as F,an as ot,n as Wt,ao as Xt}from"../chunks/Bgpcav5I.js";import{s as Z,e as U,d as lt,a as qt}from"../chunks/D9tXTNmR.js";import{p as G,i as $,b as ft}from"../chunks/DSeegchC.js";import{o as K,a as V}from"../chunks/DBa9ks76.js";import{s as vt}from"../chunks/DdJXo0iL.js";let xt=!1;function Kt(){xt||(xt=!0,document.addEventListener("reset",a=>{Promise.resolve().then(()=>{var e;if(!a.defaultPrevented)for(const t of a.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function st(a,e,t){W&&Pt();var i=a,r=Gt,s,n=Ot;Ht(()=>{n(r,r=e())&&(s&&Nt(s),s=Bt(()=>t(i)))}),W&&(i=Mt)}function Tt(a){var e,t,i="";if(typeof a=="string"||typeof a=="number")i+=a;else if(typeof a=="object")if(Array.isArray(a)){var r=a.length;for(e=0;e<r;e++)a[e]&&(t=Tt(a[e]))&&(i&&(i+=" "),i+=t)}else for(t in a)a[t]&&(i&&(i+=" "),i+=t);return i}function Vt(){for(var a,e,t=0,i="",r=arguments.length;t<r;t++)(a=arguments[t])&&(e=Tt(a))&&(i&&(i+=" "),i+=e);return i}function Qt(a){return typeof a=="object"?Vt(a):a??""}const yt=[...` 	
\r\fÂ \v\uFEFF`];function Zt(a,e,t){var i=a==null?"":""+a;if(e&&(i=i?i+" "+e:e),t){for(var r in t)if(t[r])i=i?i+" "+r:r;else if(i.length)for(var s=r.length,n=0;(n=i.indexOf(r,n))>=0;){var c=n+s;(n===0||yt.includes(i[n-1]))&&(c===i.length||yt.includes(i[c]))?i=(n===0?"":i.substring(0,n))+i.substring(c+1):n=c}}return i===""?null:i}function wt(a,e=!1){var t=e?" !important;":";",i="";for(var r in a){var s=a[r];s!=null&&s!==""&&(i+=" "+r+": "+s+t)}return i}function Jt(a,e){if(e){var t="",i,r;return Array.isArray(e)?(i=e[0],r=e[1]):i=e,i&&(t+=wt(i)),r&&(t+=wt(r,!0)),t=t.trim(),t===""?null:t}return String(a)}function gt(a,e,t,i,r,s){var n=a.__className;if(W||n!==t||n===void 0){var c=Zt(t,i,s);(!W||c!==a.getAttribute("class"))&&(c==null?a.removeAttribute("class"):a.className=c),a.__className=t}else if(s&&r!==s)for(var o in s){var p=!!s[o];(r==null||p!==!!r[o])&&a.classList.toggle(o,p)}return s}function ht(a,e={},t,i){for(var r in t){var s=t[r];e[r]!==s&&(t[r]==null?a.style.removeProperty(r):a.style.setProperty(r,s,i))}}function at(a,e,t,i){var r=a.__style;if(W||r!==e){var s=Jt(e,i);(!W||s!==a.getAttribute("style"))&&(s==null?a.removeAttribute("style"):a.style.cssText=s),a.__style=e}else i&&(Array.isArray(i)?(ht(a,t==null?void 0:t[0],i[0]),ht(a,t==null?void 0:t[1],i[1],"important")):ht(a,t,i));return i}const te=Symbol("is custom element"),ee=Symbol("is html");function ae(a){if(W){var e=!1,t=()=>{if(!e){if(e=!0,a.hasAttribute("value")){var i=a.value;it(a,"value",null),a.value=i}if(a.hasAttribute("checked")){var r=a.checked;it(a,"checked",null),a.checked=r}}};a.__on_r=t,Yt(t),Kt()}}function mt(a,e){var t=Rt(a);t.value===(t.value=e??void 0)||a.value===e&&(e!==0||a.nodeName!=="PROGRESS")||(a.value=e??"")}function it(a,e,t,i){var r=Rt(a);W&&(r[e]=a.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&a.nodeName==="LINK")||r[e]!==(r[e]=t)&&(e==="loading"&&(a[jt]=t),t==null?a.removeAttribute(e):typeof t!="string"&&ie(a).includes(e)?a[e]=t:a.setAttribute(e,t))}function Rt(a){return a.__attributes??(a.__attributes={[te]:a.nodeName.includes("-"),[ee]:a.namespaceURI===$t})}var Ct=new Map;function ie(a){var e=Ct.get(a.nodeName);if(e)return e;Ct.set(a.nodeName,e=[]);for(var t,i=a,r=Element.prototype;r!==i;){t=Ft(i);for(var s in t)t[s].set&&e.push(s);i=Ut(i)}return e}let re=0;function se(){return re++}class ne{constructor(){l(this,"_dispatcherDestroyed",!1);l(this,"listeners",{})}get dispatcherDestroyed(){return this._dispatcherDestroyed}dispatcherCheckDestroyed(){if(this.dispatcherDestroyed)throw new Error("EventDispatcher used after destroyed.")}getListenersArr(e){return this.listeners[e]||(this.listeners[e]=[]),this.listeners[e]}*listenersIter(){for(const e in this.listeners){const t=this.listeners[e];for(const i of t)yield i}}addEventListener(e,t,i=!1,r=0){this.dispatcherCheckDestroyed();const s=this.getListenersArr(e),n={key:e,callbackfn:t,priority:r,id:se(),once:i};return s.push(n),s.sort((c,o)=>c.priority-o.priority),n}dispatchEvent(e,t){this.dispatcherCheckDestroyed();const i=this.getListenersArr(e);for(const r of i){let s=!1;if(r.callbackfn({data:t,dispatcher:this,listener:r,stopPropagation:()=>s=!0}),r.once&&this.removeEventListener(r),s)break}}removeEventListener(e){this.dispatcherCheckDestroyed();let t=!1;if(typeof e!="number"){const i=this.getListenersArr(e.key);for(const r of i)r.id==e.id&&(i.splice(i.indexOf(r),1),t=!0)}else for(const i of this.listenersIter())i.id==e&&this.removeEventListener(i)&&(t=!0);return t}destroyDispatcher(){this.dispatcherCheckDestroyed(),this._dispatcherDestroyed=!0;for(const e in this.listeners)delete this.listeners[e]}}const oe=10n**1000n,_t=1000000n,Lt=Number(_t);function nt(a,e){return a*BigInt(e*Lt)/_t}function J(a,e){return Number(a*_t/e)/Lt}function et(a){return a<1e6?new Intl.NumberFormat("en-us",{notation:"standard"}).format(a):a<1e15?new Intl.NumberFormat("en-us",{notation:"compact",minimumFractionDigits:2}).format(a):new Intl.NumberFormat("en-us",{notation:"scientific",minimumFractionDigits:2}).format(a)}class ct{constructor(){l(this,"tickSteps",{})}isHeatable(){return!1}isPowerbank(){return!1}sellAmount(e){return 0n}destroy(e,t,i){}}class le extends ct{constructor(t,i,r,s){super();l(this,"info");l(this,"baseMaxHeat");l(this,"heat",0n);l(this,"basePowerCapacity");l(this,"texture");l(this,"tickSteps",{heatExplode(t,i,r){this.heat>this.maxHeat(t)&&t.explode(i,r)}});this.info=t,this.baseMaxHeat=i,this.basePowerCapacity=r,this.texture=s}maxHeat(t){return this.baseMaxHeat}powerCapacity(t){return this.basePowerCapacity}isHeatable(){return!0}isPowerbank(){return!0}sellAmount(t){const i=J(this.heat,this.maxHeat(t));return nt(this.info.cost(t.game),1-i)}render(t,i){N.draw(t,this.texture),t.fillStyle="red",t.fillRect(0,.9,J(this.heat,this.maxHeat(i)),.1)}}class dt extends ct{constructor(t,i,r,s,n,c,o){super();l(this,"info");l(this,"baseDurability");l(this,"durability");l(this,"baseHeatGeneration");l(this,"basePowerGeneration");l(this,"texture");l(this,"shouldAutoplace");l(this,"tickSteps",{applyHeat(t,i,r){t.applyHeatPattern(i,r,we,this.heatGeneration(t))},applyPower(t){t.power+=this.powerGeneration(t)},applyDurability(t,i,r){this.durability--,this.durability<=0&&t.setComponent(i,r,new ce(this.info,this.texture,this.shouldAutoplace))}});this.info=t,this.baseDurability=r,this.baseHeatGeneration=s,this.basePowerGeneration=n,this.texture=c,this.durability=this.maxDurability(i),this.shouldAutoplace=o}maxDurability(t){return this.baseDurability}heatGeneration(t){return this.baseHeatGeneration}powerGeneration(t){return this.basePowerGeneration}render(t,i){N.draw(t,this.texture),t.fillStyle="blue",t.fillRect(0,.9,this.durability/this.maxDurability(i),.1)}}class ce extends ct{constructor(t,i,r){super();l(this,"info");l(this,"texture");l(this,"shouldAutoplace");l(this,"tickSteps",{autoPlace(t,i,r){if(this.shouldAutoplace(t)){const s=this.info.cost(t.game);t.game.money>=s&&(t.game.money-=s,t.setComponent(i,r,this.info.create(t)))}}});this.info=t,this.texture=i,this.shouldAutoplace=r}render(t){t.globalAlpha=.5,N.draw(t,this.texture)}}class ue extends ct{constructor(t,i,r,s){super();l(this,"info");l(this,"baseMaxHeat");l(this,"baseHeatDissipation");l(this,"heat",0n);l(this,"texture");l(this,"tickSteps",{dissipateHeat(t){this.heat-=this.heatDissipation(t),this.heat<0&&(this.heat=0n)},heatExplode(t,i,r){this.heat>this.maxHeat(t)&&t.explode(i,r)}});this.info=t,this.baseMaxHeat=i,this.baseHeatDissipation=r,this.texture=s}maxHeat(t){return this.baseMaxHeat}heatDissipation(t){return this.baseHeatDissipation}isHeatable(){return!0}sellAmount(t){const i=J(this.heat,this.maxHeat(t));return nt(this.info.cost(t.game),1-i)}render(t,i){N.draw(t,this.texture),t.fillStyle="red",t.fillRect(0,.9,J(this.heat,this.maxHeat(i)),.1)}}class he{constructor(e){l(this,"callback");l(this,"running",!1);l(this,"animframe",-1);this.callback=e}step(){this.running&&(cancelAnimationFrame(this.animframe),this.animframe=requestAnimationFrame(()=>this.step()),this.callback())}start(){this.running=!0,cancelAnimationFrame(this.animframe),requestAnimationFrame(()=>this.step())}stop(){this.running=!1,cancelAnimationFrame(this.animframe)}}class de{constructor(e){l(this,"callback");l(this,"running",!1);l(this,"milliseconds",1e3);l(this,"interval",-1);this.callback=e}start(){this.running=!0,clearInterval(this.interval),this.interval=setInterval(()=>this.callback(),this.milliseconds)}stop(){this.running=!1,clearInterval(this.interval)}setDelay(e){if(e<10)throw new Error("IntervalCaller delay is too small");this.milliseconds=e,this.running&&this.start()}getDelay(){return this.milliseconds}}const kt=(a,e)=>{const t=new ResizeObserver(()=>{e(a.clientWidth,a.clientHeight)});return t.observe(a),{destroy(){t.unobserve(a),t.disconnect()}}};function fe(a){return a!==null}function ve(a){return a.every(fe)?a:null}function me(a){if(!a.complete||a.naturalWidth===0)return null;const t=new OffscreenCanvas(a.naturalWidth,a.naturalHeight).getContext("2d");return t.imageSmoothingEnabled=!1,t.drawImage(a,0,0),t.getImageData(0,0,a.naturalWidth,a.naturalHeight)}function pe(a,e,t=!0){class i{constructor(s,n,c,o){l(this,"x");l(this,"y");l(this,"width");l(this,"height");l(this,"value",null);this.x=s,this.y=n,this.width=c,this.height=o}insert(s,n,c){if(Array.isArray(this.value))return this.value[0].insert(s,n,c)??this.value[1].insert(s,n,c);if(typeof this.value=="string"||n>this.width||c>this.height)return null;if(n==this.width&&c==this.height)return this.value=s,this;const o=this.width-n,p=this.height-c;return this.value=[o>p?new i(this.x,this.y,n,this.height):new i(this.x,this.y,this.width,c),o>p?new i(this.x+n,this.y,this.width-n,this.height):new i(this.x,this.y+c,this.width,this.height-c)],this.value[0].insert(s,n,c)}}for(let r=32;r<=2**16;r*=2){const s=new i(0,0,r,r),n=ve(Object.entries(e).map(([h,[y,w,d,m]])=>s.insert(h,d+(t?1:0),m+(t?1:0))));if(!n)continue;const o=new OffscreenCanvas(a.width,a.height).getContext("2d");o.putImageData(a,0,0);const _=new OffscreenCanvas(s.width,s.height).getContext("2d"),g=Object.fromEntries(n.map(h=>{if(typeof h.value!="string")throw new Error("unreachable");const[y,w,d,m]=e[h.value];if(h.width-(t?1:0)!=d||h.height-(t?1:0)!=m)throw new Error("MY SANITY CHECK");return _.putImageData(o.getImageData(y,w,d,m),h.x,h.y),[h.value,[h.x,h.y,h.width-(t?1:0),h.height-(t?1:0)]]}));return[_.getImageData(s.x,s.y,s.width,s.height),g]}return console.warn("Could not pack atlas texture to reasonable size!"),[a,e]}class ge{constructor(e,t){l(this,"rebuilt",null);l(this,"rebuiltTextures",null);l(this,"image");l(this,"textures");typeof e=="string"?(this.image=new Image,this.image.src=e):this.image=e,this.image.loading="eager",this.textures=t}loadAndRebuild(){if(this.rebuilt&&this.rebuiltTextures)return!0;const e=me(this.image);if(!e)return!1;const[t,i]=pe(e,this.textures);return this.rebuiltTextures=i,this.rebuilt=new OffscreenCanvas(t.width,t.height),this.rebuilt.getContext("2d").putImageData(t,0,0),!0}draw(e,t,i=0,r=0,s=1,n=1){if(!this.loadAndRebuild())return;const[c,o,p,_]=this.rebuiltTextures[t];e.drawImage(this.rebuilt,c,o,p,_,i,r,s,n)}awaitLoad(){return new Promise((e,t)=>{if(this.loadAndRebuild())return e();const i=()=>{if(this.image.removeEventListener("load",i),this.image.removeEventListener("error",r),!this.loadAndRebuild()){t("TextureAtlas image failed to load and rebuild when it was already loaded????");return}e()},r=s=>{this.image.removeEventListener("load",i),this.image.removeEventListener("error",r),t(s)};this.image.addEventListener("load",i),this.image.addEventListener("error",r)})}async debugGetRebuiltBlob(){return await this.awaitLoad(),await this.rebuilt.convertToBlob({type:"image/png"})}async blob(e){const[t,i,r,s]=this.rebuiltTextures[e],n=new OffscreenCanvas(r,s);return n.getContext("2d").drawImage(this.rebuilt,t,i,r,s,0,0,r,s),await n.convertToBlob({type:"image/png"})}async getTextureImageBlob(e){return await this.awaitLoad(),await this.blob(e)}}class _e{constructor(e,t,i=!1){l(this,"atlas");l(this,"frames");l(this,"drawOutOfBounds");this.atlas=e,this.frames=t,this.drawOutOfBounds=i}draw(e,t,i=0,r=0,s=1,n=1){if(this.drawOutOfBounds)t=Math.min(Math.max(t,0),1);else if(t<0||t>1)return;const c=this.frames[Math.min(Math.floor(t*this.frames.length),this.frames.length-1)];this.atlas.draw(e,c,i,r,s,n)}}const N=new ge("./tileset.png",{empty:[0,0,32,32],missing_texture:[0,32,32,32],cursor_empty:[0,288,32,32],cursor_selectable:[0,320,32,32],cursor_unselectable:[0,352,32,32],floor:[0,64,32,32],big_tile:[0,224,64,64],explosion_frame_1:[0,96,32,32],explosion_frame_2:[0,128,32,32],explosion_frame_3:[0,160,32,32],explosion_frame_4:[0,192,32,32],capacitor_1:[128,0,32,32],capacitor_2:[128,32,32,32],capacitor_3:[128,64,32,32],capacitor_4:[128,96,32,32],capacitor_5:[128,128,32,32],vent_1:[160,0,32,32],vent_2:[160,32,32,32],vent_3:[160,64,32,32],vent_4:[160,96,32,32],vent_5:[160,128,32,32],uranium_cell_1:[32,0,32,32],uranium_cell_2:[64,0,32,32],uranium_cell_3:[96,0,32,32],unnamed_1_cell_1:[32,32,32,32],unnamed_1_cell_2:[64,32,32,32],unnamed_1_cell_3:[96,32,32,32],unnamed_2_cell_1:[32,64,32,32],unnamed_2_cell_2:[64,64,32,32],unnamed_2_cell_3:[96,64,32,32],unnamed_3_cell_1:[32,96,32,32],unnamed_3_cell_2:[64,96,32,32],unnamed_3_cell_3:[96,96,32,32]}),be=new _e(N,["explosion_frame_1","explosion_frame_2","explosion_frame_3","explosion_frame_4"]);function tt(a){const e={};return Object.assign(e,a(e))}const Q={capacitor_1:tt(a=>({name:"Basic Capacitor",description(){return"Basic capacitor increases the total power storage of the reactor."},texture:"capacitor_1",cost(){return 500n},create(){return new le(a,10n,100n,"capacitor_1")}})),vent_1:tt(a=>({name:"Basic Vent",description(){return"Basic vent reduces the heat of itself every tick."},texture:"vent_1",cost(){return 50n},create(){return new ue(a,25n,2n,"vent_1")}})),uranium_cell_1:tt(a=>({name:"Single Uranium Cell",description(){return"Singular uranium cell produces energy and heat every tick."},texture:"uranium_cell_1",cost(){return 0n},create(e){return new dt(a,e,10,1n,1n,"uranium_cell_1",t=>!0)}})),uranium_cell_2:tt(a=>({name:"Double Uranium Cell",description(){return"Double uranium cell produces x3 energy and heat of a singular uranium cell."},texture:"uranium_cell_2",cost(){return 5n},create(e){return new dt(a,e,10,3n,3n,"uranium_cell_2",t=>!0)}})),uranium_cell_3:tt(a=>({name:"Quad Uranium Cell",description(){return"Quad uranium cell produces x9 energy and heat of a singular uranium cell."},texture:"uranium_cell_3",cost(){return 20n},create(e){return new dt(a,e,10,9n,9n,"uranium_cell_3",t=>!0)}}))};class xe{constructor(e,t){l(this,"x");l(this,"y");l(this,"createdAt");l(this,"duration",500);this.x=e,this.y=t,this.createdAt=Date.now()}render(e){const t=(Date.now()-this.createdAt)/this.duration;return t>1?!1:(be.draw(e,t,this.x,this.y),!0)}}const Et=48,ye=["applyHeat","dissipateHeat","heatExplode","applyPower","dissipatePower","applyDurability","autoPlace"],we=[[0,-1],[1,0],[0,1],[-1,0]];class Ce{constructor(e){l(this,"reactor");l(this,"uraniumAutoPlace",!1);l(this,"uraniumPowerGeneration",0);l(this,"uraniumDurability",0);this.reactor=e}get game(){return this.reactor.game}}let ke=class{constructor(e){l(this,"game");l(this,"size",10);l(this,"upgrades");l(this,"heat",50n);l(this,"maxHeat",100n);l(this,"power",0n);l(this,"components",new Array(this.size*this.size).fill(null));l(this,"canvas",null);l(this,"ctx",null);l(this,"canvasResizeListenerDestroy",null);l(this,"animationCanvas",null);l(this,"animationCtx",null);l(this,"animationCanvasResizeListenerDestroy",null);l(this,"cursor",null);l(this,"particles",[]);this.game=e,this.upgrades=new Ce(this)}contains(e,t){return!Number.isInteger(e)||!Number.isInteger(t)?!1:e>=0&&e<this.size&&t>=0&&t<this.size}getComponent(e,t){return this.contains(e,t)?this.components[e+t*this.size]:null}setComponent(e,t,i){var s;if(!this.contains(e,t))return;const r=this.getComponent(e,t);r&&((s=r.destroy)==null||s.call(r,this,e,t)),this.components[e+t*this.size]=i}getComponentsPattern(e,t,i){return i.map(([r,s])=>this.getComponent(e+r,t+s)).filter(r=>r!=null)}applyHeatPattern(e,t,i,r){const n=this.getComponentsPattern(e,t,i).filter(_=>_.isHeatable());if(n.length==0){this.heat+=r;return}if(n.length==1){n[0].heat+=r;return}const c=r/BigInt(n.length),o=r%BigInt(n.length),p=n.reduce((_,g,h)=>g.heat<n[_].heat?h:_,0);n.forEach((_,g)=>_.heat+=g!=p?c:c+o)}explode(e,t){this.getComponent(e,t)&&this.addParticle(new xe(e,t)),this.setComponent(e,t,null)}setCanvas(e,t){var i,r,s,n;e==null?(this.canvas=null,(r=(i=this.canvasResizeListenerDestroy)==null?void 0:i.destroy)==null||r.call(i),this.canvasResizeListenerDestroy=null):(this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.canvasResizeListenerDestroy=kt(this.canvas,(c,o)=>{this.canvas&&(this.canvas.style.width=`${this.size*Et}px`,this.canvas.style.height=`${this.size*Et}px`,this.canvas.width=c,this.canvas.height=o,this.render())})??null),t==null?(this.animationCanvas=null,(n=(s=this.animationCanvasResizeListenerDestroy)==null?void 0:s.destroy)==null||n.call(s),this.animationCanvasResizeListenerDestroy=null):(this.animationCanvas=t,this.animationCtx=this.animationCanvas.getContext("2d"),this.animationCanvasResizeListenerDestroy=kt(this.animationCanvas,(c,o)=>{this.animationCanvas&&(this.animationCanvas.width=c,this.animationCanvas.height=o,this.animationCanvas.width!=this.animationCanvas.height&&console.warn("Bad sizing on reactor animation canvas.",this.canvas),this.animationRender())})??null)}destroy(){this.setCanvas(null,null)}render(){if(!(!this.canvas||!this.ctx)){this.ctx.reset(),this.ctx.imageSmoothingEnabled=!1,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.scale(this.canvas.width/this.size,this.canvas.height/this.size);for(let e=0;e<this.size;e++)for(let t=0;t<this.size;t++){N.draw(this.ctx,"floor",e,t);const i=this.getComponent(e,t);i&&(this.ctx.save(),this.ctx.translate(e,t),i.render(this.ctx,this,e,t),this.ctx.restore())}}}addParticle(e){this.particles.push(e)}animationRender(){if(!(!this.animationCanvas||!this.animationCtx)){this.animationCtx.reset(),this.animationCtx.imageSmoothingEnabled=!1,this.animationCtx.clearRect(0,0,this.animationCanvas.width,this.animationCanvas.height),this.animationCtx.scale(this.animationCanvas.width/this.size,this.animationCanvas.height/this.size);for(let e=this.particles.length-1;e>=0;e--)this.animationCtx.save(),this.particles[e].render(this.animationCtx)||this.particles.splice(e,1),this.animationCtx.restore();if(this.cursor){if(!this.contains(this.cursor.x,this.cursor.y))return;this.getComponent(this.cursor.x,this.cursor.y)?N.draw(this.animationCtx,"cursor_selectable",this.cursor.x,this.cursor.y):(this.game.selectedComponent&&(this.animationCtx.save(),this.animationCtx.globalAlpha=.5,N.draw(this.animationCtx,this.game.selectedComponent.texture,this.cursor.x,this.cursor.y),this.game.money<this.game.selectedComponent.cost(this.game)&&(this.animationCtx.fillStyle="red",this.animationCtx.globalCompositeOperation="source-atop",this.animationCtx.fillRect(this.cursor.x,this.cursor.y,1,1)),this.animationCtx.restore()),N.draw(this.animationCtx,"cursor_empty",this.cursor.x,this.cursor.y))}}}maxPower(){let e=100n;for(let t=0;t<this.size;t++)for(let i=0;i<this.size;i++){const r=this.getComponent(t,i);r&&r.isPowerbank()&&(e+=r.powerCapacity(this))}return e}tick(){if(ye.forEach(e=>{var t,i;for(let r=0;r<this.size;r++)for(let s=0;s<this.size;s++){const n=this.getComponent(r,s);(i=(t=n==null?void 0:n.tickSteps)==null?void 0:t[e])==null||i.call(n,this,r,s)}e=="dissipatePower"&&this.power>this.maxPower()&&(this.power=this.maxPower())}),this.heat-=1n,this.heat<0n&&(this.heat=0n),this.heat>this.maxHeat){for(let e=0;e<this.size;e++)for(let t=0;t<this.size;t++)this.getComponent(e,t)&&(this.explode(e,t),this.heat=nt(this.heat,1.1));this.heat=nt(this.heat,.9)}}};class Ee{constructor(e){l(this,"game");l(this,"fasterTicks",0);this.game=e}}class De extends ne{constructor(){super();l(this,"reactor");l(this,"upgrades");l(this,"selectedComponent",null);l(this,"money",0n);l(this,"debugTickRateOverride",null);l(this,"extraTicks",0);this.reactor=new ke(this),this.upgrades=new Ee(this),this.addEventListener("tick",()=>this.tick())}tickRate(){return this.debugTickRateOverride!==null?this.debugTickRateOverride:1e3/(this.upgrades.fasterTicks+1)}tick(){this.reactor.tick()}destroy(){this.reactor.destroy(),this.destroyDispatcher()}}var Ae=R('<img draggable="false">');function Dt(a,e){X(e,!0);let t=G(e,"class",3,""),i=L(null);K(async()=>{let c=await e.atlas.getTextureImageBlob(e.texture);C(i,URL.createObjectURL(c),!0)}),V(()=>{u(i)&&URL.revokeObjectURL(u(i))});var r=pt(),s=Y(r);{var n=c=>{var o=Ae();H(()=>{it(o,"src",u(i)),it(o,"alt",e.texture),gt(o,1,Qt(t()))}),k(c,o)};$(s,c=>{u(i)&&c(n)})}k(a,r),q()}var Te=R('<div><div class="flex items-center justify-between"><span class="font-jersey px-1 text-xl"> </span> <!></div> <div><!></div></div>');function rt(a,e){let t=G(e,"titleDark",3,!1),i=G(e,"gradientEnd",19,()=>e.gradientStart),r=G(e,"class",3,""),s=G(e,"titleRightContent",3,null);var n=Te(),c=f(n);let o;var p=f(c);let _;var g=f(p,!0);v(p);var h=b(p,2);{var y=m=>{var S=pt(),z=Y(S);vt(z,s),k(m,S)};$(h,m=>{s()&&m(y)})}v(c);var w=b(c,2),d=f(w);vt(d,()=>e.children),v(w),v(n),H(()=>{gt(n,1,`shadow-outline-up flex flex-col bg-zinc-300 ${r()??""} gap-1 p-1`),o=at(c,"",o,{background:`linear-gradient(90deg, ${e.gradientStart??""} 0%, ${i()??""} 100%)`}),_=at(p,"",_,{color:t()?"var(--color-black)":"var(--color-white)"}),Z(g,e.title)}),k(a,n)}var Re=R('<div class="pointer-events-none fixed z-50 p-2"><div class="h-max w-max border-2 border-black/50 bg-white/50 backdrop-blur-sm"><!></div></div>');function Le(a,e){let t=L(0),i=L(0);var r=Re();U("mousemove",F.body,o=>{C(t,o.clientX,!0),C(i,o.clientY,!0)});let s;var n=f(r),c=f(n);vt(c,()=>e.children),v(n),v(r),H(()=>s=at(r,"",s,{left:`${u(t)??""}px`,top:`${u(i)??""}px`})),k(a,r)}var Ie=(a,e,t)=>{e()&&(e().selectedComponent=t(),e().dispatchEvent("render",null))},Se=R('<button class="button size-10 p-0.5"><!></button>'),ze=(a,e)=>C(e,"cells"),Pe=(a,e)=>C(e,"components"),He=R('<div class="flex h-16 flex-col justify-center px-2 py-1"><h1 class="font-jersey text-4xl">CELLS</h1> <span>Hover cells to view information.</span></div> <div class="mx-0.5 mb-1 h-[2px] bg-zinc-500"></div> <div class="flex-col"><div><!> <!> <!></div></div>',1),Oe=R('<div class="flex h-16 flex-col justify-center px-2 py-1"><h1 class="font-jersey text-4xl">COMPONENTS</h1> <span>Hover components to view information.</span></div> <div class="mx-0.5 mb-1 h-[2px] bg-zinc-500"></div> <div class="flex-col"><div><!></div> <div><!></div></div>',1),Ne=R('<div class="flex max-w-48 items-center justify-between"><!> <span class="leading-[0.8]"> </span></div>'),Be=R('<div class="flex items-center justify-between gap-2"><div><button class="button px-2 py-1">Cells</button> <button class="button px-2 py-1">Components</button></div> <span class="font-jersey w-28 text-3xl">$<!></span></div> <div class="mx-0.5 mt-1 h-[2px] bg-zinc-500"></div> <!> <!>',1);function Me(a,e){X(e,!0);const t=(p,_=Wt)=>{var g=Se();g.__click=[Ie,s,_];var h=f(g);Dt(h,{atlas:N,get texture(){return _().texture},class:"size-full"}),v(g),H(()=>{var y,w;return g.disabled=!u(i)||((w=(y=s())==null?void 0:y.selectedComponent)==null?void 0:w.name)==_().name}),U("mouseenter",g,()=>{C(o,_(),!0)}),U("mouseleave",g,()=>{var y;((y=u(o))==null?void 0:y.name)==_().name&&C(o,null)}),k(p,g)};let i=L(0),r=-1,s=G(e,"game",7),n=G(e,"class",3,""),c=L("cells"),o=L(null);K(()=>{r=s().addEventListener("render",()=>{ot(i)}).id}),V(()=>{s().removeEventListener(r)}),rt(a,{title:"Shop",gradientStart:"blue",gradientEnd:"lightblue",get class(){return`w-64 ${n()??""}`},children:(p,_)=>{var g=Be(),h=Y(g),y=f(h),w=f(y);w.__click=[ze,c];var d=b(w,2);d.__click=[Pe,c],v(y);var m=b(y,2),S=b(f(m));st(S,()=>u(i),E=>{var A=At();H(T=>Z(A,T),[()=>et(s().money)]),k(E,A)}),v(m),v(h);var z=b(h,4);{var B=E=>{var A=He(),T=b(Y(A),4),x=f(T),D=f(x);t(D,()=>Q.uranium_cell_1);var I=b(D,2);t(I,()=>Q.uranium_cell_2);var M=b(I,2);t(M,()=>Q.uranium_cell_3),v(x),v(T),k(E,A)},j=(E,A)=>{{var T=x=>{var D=Oe(),I=b(Y(D),4),M=f(I),ut=f(M);t(ut,()=>Q.capacitor_1),v(M);var bt=b(M,2),It=f(bt);t(It,()=>Q.vent_1),v(bt),v(I),k(x,D)};$(E,x=>{u(c)=="components"&&x(T)},A)}};$(z,E=>{u(c)=="cells"?E(B):E(j,!1)})}var P=b(z,2);{var O=E=>{Le(E,{children:(A,T)=>{var x=Ne(),D=f(x);Dt(D,{atlas:N,get texture(){return u(o).texture},class:"aspect-square h-16 p-1"});var I=b(D,2),M=f(I,!0);v(I),v(x),H(ut=>Z(M,ut),[()=>u(o).description(s())]),k(A,x)}})};$(P,E=>{u(o)&&E(O)})}H(()=>{w.disabled=u(c)=="cells",d.disabled=u(c)=="components"}),k(p,g)},$$slots:{default:!0}}),q()}lt(["click"]);var Ge=R('<progress class="reactor-heat-progress svelte-1ya4qtj"></progress> <div class="flex items-center px-2"><span class="text-white"> </span></div>',1),je=R('<progress class="reactor-power-progress svelte-1ya4qtj"></progress> <div class="flex items-center justify-between px-2"><span class="text-white"> </span> <span class="text-white">SELL</span></div>',1),$e=(a,e)=>{e().game.money+=e().power,e().power=0n,e().game.dispatchEvent("render",null)},Ue=(a,e)=>{e(a)},Fe=(a,e)=>{e(a)},Ye=(a,e,t,i)=>{u(e)&&(t().cursor={x:Math.floor(a.offsetX/u(e).clientWidth*t().size),y:Math.floor(a.offsetY/u(e).clientHeight*t().size)},i(a))},We=a=>a.preventDefault(),Xe=a=>a.preventDefault(),qe=R('<div class="flex flex-col gap-1"><div class="grid grid-cols-2 gap-2"><div class="force-overlap"><!></div> <div class="force-overlap"><!> <button class="cursor-pointer"></button></div></div> <div class="force-overlap relative"><canvas></canvas> <canvas class="absolute size-full cursor-pointer"></canvas></div></div>');function Ke(a,e){X(e,!0);let t=L(0),i=-1,r=L(null),s=L(null),n=null;function c(p){if(!o().cursor)return;const _=!!(p.buttons&1),g=!!(p.buttons&2);if(!(_==!0&&g==!0)){if(_==!0&&o().game.selectedComponent&&o().getComponent(o().cursor.x,o().cursor.y)==null&&o().heat<o().maxHeat){const h=o().game.selectedComponent.cost(o().game);o().game.money>=h&&(o().game.money-=h,o().setComponent(o().cursor.x,o().cursor.y,o().game.selectedComponent.create(o())),o().game.dispatchEvent("render",null))}if(g==!0){const h=o().getComponent(o().cursor.x,o().cursor.y);h&&(o().game.money+=h.sellAmount(o()),o().setComponent(o().cursor.x,o().cursor.y,null),o().game.dispatchEvent("render",null))}}}let o=G(e,"reactor",7);K(()=>{o().setCanvas(u(r),u(s)),i=o().game.addEventListener("render",()=>{ot(t),o().render()}).id,n=new he(()=>{o().animationRender()}),n.start(),async function(){await N.awaitLoad(),o().render()}()}),V(()=>{o().setCanvas(null,null),o().game.removeEventListener(i),n==null||n.stop(),n=null}),rt(a,{title:"Reactor",gradientStart:"red",gradientEnd:"pink",children:(p,_)=>{var g=qe(),h=f(g),y=f(h),w=f(y);st(w,()=>u(t),P=>{var O=Ge(),E=Y(O),A=b(E,2),T=f(A),x=f(T);v(T),v(A),H((D,I,M)=>{mt(E,D),Z(x,`HEAT ${I??""}/${M??""}`)},[()=>J(o().heat,o().maxHeat),()=>et(o().heat),()=>et(o().maxHeat)]),k(P,O)}),v(y);var d=b(y,2),m=f(d);st(m,()=>u(t),P=>{var O=je(),E=Y(O),A=b(E,2),T=f(A),x=f(T);v(T),Xt(2),v(A),H((D,I,M)=>{mt(E,D),Z(x,`POWER
                            ${I??""}/${M??""}`)},[()=>J(o().power,o().maxPower()),()=>et(o().power),()=>et(o().maxPower())]),k(P,O)});var S=b(m,2);S.__click=[$e,o],v(d),v(h);var z=b(h,2);z.__mousedown=[Ue,c],z.__mouseup=[Fe,c],z.__mousemove=[Ye,r,o,c];var B=f(z);B.__contextmenu=[We],ft(B,P=>C(r,P),()=>u(r));var j=b(B,2);j.__contextmenu=[Xe],ft(j,P=>C(s,P),()=>u(s)),v(z),v(g),U("mouseleave",z,()=>{o().cursor=null}),k(p,g)},$$slots:{default:!0}}),q()}lt(["click","mousedown","mouseup","mousemove","contextmenu"]);var Ve=R('<img class="size-full" src="./button-pause.png" alt="Pause" draggable="false">'),Qe=R('<img class="size-full" src="./button-play.png" alt="Play" draggable="false">'),Ze=R('<div class="flex w-56 justify-between"><div class="flex items-center gap-1"><button class="button size-6"><!></button> <button class="button size-6 disabled:cursor-not-allowed"><img class="size-full" src="./button-step.png" alt="Step" draggable="false"></button></div> <div class="flex items-center gap-1"><span class="font-jersey text-3xl"><!></span> <button><img class="size-full" src="./button-fast-forward.png" alt="Fast Forward" draggable="false"></button></div></div>');function Je(a,e){X(e,!0);let t=G(e,"game",7),i=L(0),r=-1,s=L(!0),n=null,c=-1/0,o=L(!1);const p=25,_=10;function g(){var h,y,w,d;if(u(o))for(let m=0;m<_;m++){if(t().extraTicks-=1,t().extraTicks<=0n){t().extraTicks=0,C(o,!1);break}(h=t())==null||h.dispatchEvent("tick",null)}else(y=t())==null||y.dispatchEvent("tick",null),((w=t())==null?void 0:w.tickRate())!=(n==null?void 0:n.getDelay())&&(n==null||n.setDelay(t().tickRate()));(d=t())==null||d.dispatchEvent("render",null),C(i,u(i)+1)}K(()=>{n=new de(g),n.setDelay(t().tickRate()),n.start(),r=t().addEventListener("render",()=>{ot(i)}).id}),V(()=>{n==null||n.stop(),n=null,t().removeEventListener(r)}),rt(a,{title:"Simulation Controls",titleDark:!0,gradientStart:"yellow",gradientEnd:"white",children:(h,y)=>{var w=Ze(),d=f(w),m=f(d);m.__click=()=>{u(s)?(C(s,!1),C(o,!1),n==null||n.stop()):(C(s,!0),n==null||n.start())};var S=f(m);{var z=x=>{var D=Ve();k(x,D)},B=x=>{var D=Qe();k(x,D)};$(S,x=>{u(s)?x(z):x(B,!1)})}v(m);var j=b(m,2);j.__click=()=>{u(s)||Date.now()-c<t().tickRate()||(c=Date.now(),g())},v(d);var P=b(d,2),O=f(P),E=f(O);st(E,()=>u(i),x=>{var D=At();H(I=>Z(D,I),[()=>new Intl.NumberFormat("en-us",{maximumFractionDigits:0}).format(t().extraTicks)]),k(x,D)}),v(O);var A=b(O,2);let T;A.__click=()=>{u(s)&&t().extraTicks!=0&&(C(o,!u(o)),n==null||n.setDelay(u(o)?p:t().tickRate()))},v(P),v(w),H(x=>{j.disabled=u(s),T=gt(A,1,"button size-6 disabled:cursor-not-allowed",null,T,x),A.disabled=!u(i)||!u(s)||t().extraTicks<=0},[()=>({"button-active":u(o)})]),k(h,w)},$$slots:{default:!0}}),q()}lt(["click"]);var ta=R('<img class="allow-context-menu" alt="Debug tileset atlas">');function ea(a,e){X(e,!0);let t=L(null);K(()=>{N.debugGetRebuiltBlob().then(i=>{C(t,URL.createObjectURL(i),!0)})}),V(()=>{u(t)&&URL.revokeObjectURL(u(t))}),rt(a,{title:"DEBUG: Tilset Atlas Image",gradientStart:"black",children:(i,r)=>{var s=pt(),n=Y(s);{var c=o=>{var p=ta();H(()=>it(p,"src",u(t))),k(o,p)};$(n,o=>{u(t)&&o(c)})}k(i,s)},$$slots:{default:!0}}),q()}var aa=(a,e)=>{e().money=oe,e().dispatchEvent("render",null)},ia=(a,e)=>{e().extraTicks=1/0,e().dispatchEvent("render",null)},ra=(a,e)=>{a.currentTarget.checked?e().debugTickRateOverride=1e3:e().debugTickRateOverride=null,e().dispatchEvent("render",null)},sa=R('<input class="arrow-hide outline-2 outline-black" type="number" min="10" max="10000" step="1">'),na=R('<div class="flex flex-col gap-1"><div class="flex gap-1"><button class="button px-2 py-1">Infinite money</button> <button class="button px-2 py-1">Infinite extra ticks</button></div> <div class="flex h-4 items-center gap-2"><span>Tickrate:</span> <input type="checkbox"> <!></div></div>');function oa(a,e){X(e,!0);let t=L(0),i=-1,r=G(e,"game",7);K(()=>{i=r().addEventListener("render",()=>ot(t)).id}),V(()=>{r().removeEventListener(i)}),rt(a,{title:"DEBUG: Cheats",gradientStart:"black",children:(s,n)=>{var c=na(),o=f(c),p=f(o);p.__click=[aa,r];var _=b(p,2);_.__click=[ia,r],v(o);var g=b(o,2),h=b(f(g),2);h.__change=[ra,r];var y=b(h,2);{var w=d=>{var m=sa();ae(m),m.__change=S=>{r().debugTickRateOverride=Math.min(Math.max(Number(S.currentTarget.value),10),1e4),S.currentTarget.value=r().debugTickRateOverride.toString()},H(()=>mt(m,r().debugTickRateOverride)),k(d,m)};$(y,d=>{u(t)&&r().debugTickRateOverride!==null&&d(w)})}v(g),v(c),k(s,c)},$$slots:{default:!0}}),q()}lt(["click","change"]);var la=R('<div class="bg-drag flex gap-1"><!> <!></div>'),ca=R('<div class="bg-drag flex flex-col gap-1"><div class="bg-drag flex"><!></div> <div class="bg-drag flex gap-1"><!> <div class="bg-drag"><!></div></div> <!></div>'),ua=R('<div class="bg-drag absolute h-screen w-screen"><div class="bg-drag absolute h-max w-max"><!></div></div>');function ha(a,e){X(e,!0);let t=G(e,"debug",3,!1),i=L(null),r,s=L(!1),n=L(!1),c=L(0),o=L(0);K(()=>{C(i,new De,!0);for(let d=0;d<10;d++)for(let m=0;m<10;m++)u(i).reactor.setComponent(d,m,Q.uranium_cell_1.create(u(i).reactor))}),V(()=>{var d;(d=u(i))==null||d.destroy(),C(i,null)});var p=ua();ft(F.body,d=>r=d,()=>r),U("mousedown",F.body,d=>{u(s)&&C(n,!!(d.buttons&1))}),U("mouseup",F.body,d=>{u(s)&&C(n,!!(d.buttons&1))}),U("mousemove",F.body,d=>{var m;(m=d.target)!=null&&m.classList.contains("bg-drag")?C(s,!0):C(s,!1),u(n)&&(C(c,u(c)+d.movementX),C(o,u(o)+d.movementY))}),U("mouseleave",F.body,()=>{C(n,!1)});let _;var g=f(p);let h;var y=f(g);{var w=d=>{var m=ca(),S=f(m),z=f(S);Je(z,{get game(){return u(i)}}),v(S);var B=b(S,2),j=f(B);Ke(j,{get reactor(){return u(i).reactor}});var P=b(j,2),O=f(P);Me(O,{get game(){return u(i)}}),v(P),v(B);var E=b(B,2);{var A=T=>{var x=la(),D=f(x);ea(D,{});var I=b(D,2);oa(I,{get game(){return u(i)}}),v(x),k(T,x)};$(E,T=>{t()&&T(A)})}v(m),k(d,m)};$(y,d=>{u(i)&&d(w)})}v(g),v(p),H(()=>{_=at(p,"",_,{background:"url(./background.png)","background-position":`${u(c)??""}px ${u(o)??""}px`,cursor:u(s)?u(n)?"move":"pointer":null}),h=at(g,"",h,{left:`${u(c)??""}px`,top:`${u(o)??""}px`})}),k(a,p),q()}const da=!1;function ya(a){qt(e=>{F.title="Reactor Game"}),U("contextmenu",F.body,e=>{var t;(t=e.target)!=null&&t.classList.contains("allow-context-menu")||e.preventDefault()}),ha(a,{debug:da})}export{ya as component};
